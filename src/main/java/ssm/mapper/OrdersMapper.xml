<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssm.mapper.OrdersMapper">
    <!-- 查询 对应一对多嵌套查询 -->
    <resultMap type="ssm.pojo.Orders" id="findOrdersByCustomerResult">
        <id property="id" column="id"/>
        <result property="number" column="number"/>
    </resultMap>
    <select id="findOrdersByCustomerId" parameterType="int" resultMap="findOrdersByCustomerResult">
        select * from t_orders orders where orders.customer_id=#{customer_id}
    </select>

    <!-- 多对多嵌套查询：通过执行另外一条SQL映射语句来返回预期的特殊类型 -->
    <select id="findOrdersWithPorduct" parameterType="Integer"
            resultMap="OrdersWithProductResult">
		select * from t_orders WHERE id=#{id}
	</select>
    <resultMap type="ssm.pojo.Orders" id="OrdersWithProductResult">
        <id property="id" column="id" />
        <result property="number" column="number" />
        <collection property="productList" column="id" ofType="ssm.pojo.Product"
                    select="ssm.mapper.ProductMapper.findProductById">
        </collection>
    </resultMap>

    <!-- 多对多嵌套结果查询：查询某订单及其关联的商品详情 -->
    <select id="findOrdersWithPorduct2" parameterType="Integer"
            resultMap="OrdersWithPorductResult2">
	    select o.*,p.id as product_id,p.name,p.price
	    from t_orders o,t_product p,t_ordersitem  oi
	    WHERE oi.orders_id=o.id
	    and oi.product_id=p.id
	    and o.id=#{id}
	</select>
    <!-- 嵌套结果查询 属性 -->
    <resultMap type="ssm.pojo.Orders" id="OrdersWithPorductResult2">
        <id property="id" column="id" />
        <result property="number" column="number" />
        <!-- 多对多关联映射：collection -->
        <collection property="productList" ofType="ssm.pojo.Product">
            <id property="id" column="product_id" />
            <result property="name" column="name" />
            <result property="price" column="price" />
        </collection>
    </resultMap>

</mapper>
